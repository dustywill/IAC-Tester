<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" width="1200" height="900">
  <defs>
    <style>
      .title { font: bold 24px monospace; fill: #e85d04; }
      .subtitle { font: 14px monospace; fill: #8b949e; }
      .component-label { font: bold 14px monospace; fill: #22c55e; }
      .pin-label { font: 11px monospace; fill: #e6e6e6; }
      .note { font: italic 11px monospace; fill: #8b949e; }
      .wire-power { stroke: #ef4444; stroke-width: 2; fill: none; }
      .wire-gnd { stroke: #484f58; stroke-width: 2; fill: none; }
      .wire-signal { stroke: #3b82f6; stroke-width: 1.5; fill: none; }
      .wire-motor { stroke: #22c55e; stroke-width: 2; fill: none; }
      .component-box { fill: #1c242e; stroke: #2d3640; stroke-width: 2; rx: 8; }
      .component-box-highlight { fill: #141a22; stroke: #e85d04; stroke-width: 2; rx: 8; }
      .pin-dot { fill: #e6e6e6; }
      .connection-dot { fill: #22c55e; }
    </style>
  </defs>
  
  <!-- Background -->
  <rect width="100%" height="100%" fill="#0a0e14"/>
  
  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" class="title">IAC VALVE TESTER - WIRING DIAGRAM</text>
  <text x="600" y="60" text-anchor="middle" class="subtitle">1997 Jeep Wrangler 2.5L • ESP32 + TB6612FNG + PC817</text>
  
  <!-- Legend -->
  <g transform="translate(950, 80)">
    <text x="0" y="0" class="component-label">WIRE LEGEND</text>
    <line x1="0" y1="15" x2="40" y2="15" class="wire-power"/>
    <text x="50" y="20" class="pin-label">12V Power</text>
    <line x1="0" y1="35" x2="40" y2="35" style="stroke: #f59e0b; stroke-width: 2;"/>
    <text x="50" y="40" class="pin-label">5V Power</text>
    <line x1="0" y1="55" x2="40" y2="55" class="wire-gnd"/>
    <text x="50" y="60" class="pin-label">Ground</text>
    <line x1="0" y1="75" x2="40" y2="75" class="wire-signal"/>
    <text x="50" y="80" class="pin-label">Logic Signal</text>
    <line x1="0" y1="95" x2="40" y2="95" class="wire-motor"/>
    <text x="50" y="100" class="pin-label">Motor Output</text>
  </g>
  
  <!-- 12V Car Battery -->
  <g transform="translate(50, 150)">
    <rect x="0" y="0" width="120" height="80" class="component-box-highlight"/>
    <text x="60" y="25" text-anchor="middle" class="component-label">12V CAR</text>
    <text x="60" y="45" text-anchor="middle" class="component-label">BATTERY</text>
    <text x="60" y="70" text-anchor="middle" class="note">(via fused tap)</text>
    <circle cx="120" cy="30" r="4" class="pin-dot"/>
    <text x="130" y="35" class="pin-label">+12V</text>
    <circle cx="120" cy="55" r="4" class="pin-dot"/>
    <text x="130" y="60" class="pin-label">GND</text>
  </g>
  
  <!-- LM2596 Buck Converter -->
  <g transform="translate(250, 130)">
    <rect x="0" y="0" width="140" height="100" class="component-box"/>
    <text x="70" y="25" text-anchor="middle" class="component-label">LM2596</text>
    <text x="70" y="45" text-anchor="middle" class="component-label">BUCK CONV</text>
    <text x="70" y="65" text-anchor="middle" class="note">12V → 5V</text>
    <!-- Input pins -->
    <circle cx="0" cy="30" r="4" class="pin-dot"/>
    <text x="-35" y="35" class="pin-label">IN+</text>
    <circle cx="0" cy="70" r="4" class="pin-dot"/>
    <text x="-35" y="75" class="pin-label">IN-</text>
    <!-- Output pins -->
    <circle cx="140" cy="30" r="4" class="pin-dot"/>
    <text x="150" y="35" class="pin-label">OUT+ (5V)</text>
    <circle cx="140" cy="70" r="4" class="pin-dot"/>
    <text x="150" y="75" class="pin-label">OUT-</text>
  </g>
  
  <!-- Wires: Battery to Buck -->
  <path d="M 170 180 L 250 160" class="wire-power"/>
  <path d="M 170 205 L 200 205 L 200 200 L 250 200" class="wire-gnd"/>
  
  <!-- ESP32 -->
  <g transform="translate(480, 100)">
    <rect x="0" y="0" width="180" height="280" class="component-box-highlight"/>
    <text x="90" y="30" text-anchor="middle" class="component-label">ESP32</text>
    <text x="90" y="50" text-anchor="middle" class="component-label">DevKitC</text>
    
    <!-- Power pins (left side) -->
    <circle cx="0" cy="80" r="4" class="pin-dot"/>
    <text x="10" y="85" class="pin-label">VIN (5V)</text>
    <circle cx="0" cy="100" r="4" class="pin-dot"/>
    <text x="10" y="105" class="pin-label">GND</text>
    <circle cx="0" cy="120" r="4" class="pin-dot"/>
    <text x="10" y="125" class="pin-label">3.3V</text>
    
    <!-- Motor control pins (right side) -->
    <circle cx="180" cy="80" r="4" class="pin-dot"/>
    <text x="100" y="85" class="pin-label">GPIO25 (AIN1)</text>
    <circle cx="180" cy="100" r="4" class="pin-dot"/>
    <text x="100" y="105" class="pin-label">GPIO26 (AIN2)</text>
    <circle cx="180" cy="120" r="4" class="pin-dot"/>
    <text x="100" y="125" class="pin-label">GPIO27 (BIN1)</text>
    <circle cx="180" cy="140" r="4" class="pin-dot"/>
    <text x="100" y="145" class="pin-label">GPIO14 (BIN2)</text>
    <circle cx="180" cy="160" r="4" class="pin-dot"/>
    <text x="100" y="165" class="pin-label">GPIO13 (STBY)</text>
    
    <!-- PCM monitor pins (right side, lower) -->
    <circle cx="180" cy="200" r="4" class="pin-dot"/>
    <text x="95" y="205" class="pin-label">GPIO32 (PCM_A1)</text>
    <circle cx="180" cy="220" r="4" class="pin-dot"/>
    <text x="95" y="225" class="pin-label">GPIO33 (PCM_A2)</text>
    <circle cx="180" cy="240" r="4" class="pin-dot"/>
    <text x="95" y="245" class="pin-label">GPIO34 (PCM_B1)</text>
    <circle cx="180" cy="260" r="4" class="pin-dot"/>
    <text x="95" y="265" class="pin-label">GPIO35 (PCM_B2)</text>
  </g>
  
  <!-- Wire: Buck to ESP32 5V -->
  <path d="M 390 160 L 440 160 L 440 180 L 480 180" style="stroke: #f59e0b; stroke-width: 2; fill: none;"/>
  <!-- Wire: Buck GND to ESP32 GND -->
  <path d="M 390 200 L 420 200 L 420 200 L 480 200" class="wire-gnd"/>
  
  <!-- TB6612FNG Motor Driver -->
  <g transform="translate(750, 100)">
    <rect x="0" y="0" width="160" height="200" class="component-box"/>
    <text x="80" y="25" text-anchor="middle" class="component-label">TB6612FNG</text>
    <text x="80" y="45" text-anchor="middle" class="component-label">MOTOR DRIVER</text>
    
    <!-- Power pins -->
    <circle cx="0" cy="70" r="4" class="pin-dot"/>
    <text x="10" y="75" class="pin-label">VM (12V)</text>
    <circle cx="0" cy="90" r="4" class="pin-dot"/>
    <text x="10" y="95" class="pin-label">VCC (3.3V)</text>
    <circle cx="0" cy="110" r="4" class="pin-dot"/>
    <text x="10" y="115" class="pin-label">GND</text>
    
    <!-- Control pins -->
    <circle cx="0" cy="140" r="4" class="pin-dot"/>
    <text x="10" y="145" class="pin-label">AIN1</text>
    <circle cx="0" cy="155" r="4" class="pin-dot"/>
    <text x="10" y="160" class="pin-label">AIN2</text>
    <circle cx="0" cy="170" r="4" class="pin-dot"/>
    <text x="10" y="175" class="pin-label">BIN1</text>
    <circle cx="0" cy="185" r="4" class="pin-dot"/>
    <text x="10" y="190" class="pin-label">BIN2</text>
    
    <!-- STBY pin -->
    <circle cx="80" cy="200" r="4" class="pin-dot"/>
    <text x="55" y="215" class="pin-label">STBY</text>
    
    <!-- Motor output pins -->
    <circle cx="160" cy="100" r="4" class="pin-dot"/>
    <text x="115" y="95" class="pin-label">A01</text>
    <circle cx="160" cy="120" r="4" class="pin-dot"/>
    <text x="115" y="115" class="pin-label">A02</text>
    <circle cx="160" cy="150" r="4" class="pin-dot"/>
    <text x="115" y="145" class="pin-label">B01</text>
    <circle cx="160" cy="170" r="4" class="pin-dot"/>
    <text x="115" y="165" class="pin-label">B02</text>
  </g>
  
  <!-- Capacitor near TB6612 -->
  <g transform="translate(700, 160)">
    <line x1="0" y1="0" x2="0" y2="20" style="stroke: #e6e6e6; stroke-width: 2;"/>
    <line x1="-8" y1="20" x2="8" y2="20" style="stroke: #e6e6e6; stroke-width: 3;"/>
    <line x1="-5" y1="26" x2="5" y2="26" style="stroke: #e6e6e6; stroke-width: 2;"/>
    <text x="-40" y="25" class="note">10µF</text>
  </g>
  
  <!-- Wires: ESP32 to TB6612 control -->
  <path d="M 660 180 L 700 180 L 700 240 L 750 240" class="wire-signal"/>
  <path d="M 660 200 L 710 200 L 710 255 L 750 255" class="wire-signal"/>
  <path d="M 660 220 L 720 220 L 720 270 L 750 270" class="wire-signal"/>
  <path d="M 660 240 L 730 240 L 730 285 L 750 285" class="wire-signal"/>
  <path d="M 660 260 L 740 260 L 740 300 L 830 300" class="wire-signal"/>
  
  <!-- Wire: 12V to TB6612 VM -->
  <path d="M 170 180 L 200 180 L 200 120 L 680 120 L 680 170 L 750 170" class="wire-power"/>
  
  <!-- Wire: 3.3V from ESP32 to TB6612 VCC -->
  <path d="M 480 220 L 460 220 L 460 250 L 700 250 L 700 190 L 750 190" style="stroke: #a855f7; stroke-width: 1.5; fill: none;"/>
  
  <!-- IAC Valve -->
  <g transform="translate(980, 100)">
    <rect x="0" y="0" width="140" height="140" class="component-box-highlight"/>
    <text x="70" y="30" text-anchor="middle" class="component-label">IAC VALVE</text>
    <text x="70" y="50" text-anchor="middle" class="note">Bipolar Stepper</text>
    
    <!-- Coil A -->
    <text x="20" y="75" class="pin-label">Coil A</text>
    <circle cx="0" cy="85" r="4" class="pin-dot"/>
    <text x="-25" y="90" class="pin-label">A1</text>
    <circle cx="0" cy="105" r="4" class="pin-dot"/>
    <text x="-25" y="110" class="pin-label">A2</text>
    
    <!-- Coil B -->
    <text x="20" y="125" class="pin-label">Coil B</text>
    <circle cx="0" cy="135" r="4" class="pin-dot"/>
    <text x="-25" y="140" class="pin-label">B1</text>
    <circle cx="0" cy="155" r="4" class="pin-dot"/>
    <text x="-25" y="160" class="pin-label">B2</text>
  </g>
  
  <!-- Wires: TB6612 to IAC -->
  <path d="M 910 200 L 940 200 L 940 185 L 980 185" class="wire-motor"/>
  <path d="M 910 220 L 950 220 L 950 205 L 980 205" class="wire-motor"/>
  <path d="M 910 250 L 940 250 L 940 235 L 980 235" class="wire-motor"/>
  <path d="M 910 270 L 950 270 L 950 255 L 980 255" class="wire-motor"/>
  
  <!-- PCM Connector (source of signals to monitor) -->
  <g transform="translate(50, 450)">
    <rect x="0" y="0" width="140" height="140" class="component-box-highlight"/>
    <text x="70" y="30" text-anchor="middle" class="component-label">PCM</text>
    <text x="70" y="50" text-anchor="middle" class="component-label">CONNECTOR</text>
    <text x="70" y="70" text-anchor="middle" class="note">(Original IAC plug)</text>
    
    <circle cx="140" cy="85" r="4" class="pin-dot"/>
    <text x="95" y="90" class="pin-label">A1</text>
    <circle cx="140" cy="105" r="4" class="pin-dot"/>
    <text x="95" y="110" class="pin-label">A2</text>
    <circle cx="140" cy="125" r="4" class="pin-dot"/>
    <text x="95" y="130" class="pin-label">B1</text>
    <circle cx="140" cy="145" r="4" class="pin-dot"/>
    <text x="95" y="150" class="pin-label">B2</text>
  </g>
  
  <!-- PC817 Optocoupler Board -->
  <g transform="translate(300, 420)">
    <rect x="0" y="0" width="220" height="180" class="component-box"/>
    <text x="110" y="25" text-anchor="middle" class="component-label">PC817 8-CH</text>
    <text x="110" y="45" text-anchor="middle" class="component-label">OPTOCOUPLER</text>
    <text x="110" y="65" text-anchor="middle" class="note">(Using 4 channels)</text>
    
    <!-- Input side (from PCM) -->
    <text x="10" y="90" class="pin-label">INPUT (12V side)</text>
    <circle cx="0" cy="105" r="4" class="pin-dot"/>
    <text x="10" y="110" class="pin-label">IN1+ (A1)</text>
    <circle cx="0" cy="125" r="4" class="pin-dot"/>
    <text x="10" y="130" class="pin-label">IN2+ (A2)</text>
    <circle cx="0" cy="145" r="4" class="pin-dot"/>
    <text x="10" y="150" class="pin-label">IN3+ (B1)</text>
    <circle cx="0" cy="165" r="4" class="pin-dot"/>
    <text x="10" y="170" class="pin-label">IN4+ (B2)</text>
    
    <!-- Output side (to ESP32) -->
    <text x="130" y="90" class="pin-label">OUTPUT (3.3V side)</text>
    <circle cx="220" cy="105" r="4" class="pin-dot"/>
    <text x="165" y="110" class="pin-label">OUT1</text>
    <circle cx="220" cy="125" r="4" class="pin-dot"/>
    <text x="165" y="130" class="pin-label">OUT2</text>
    <circle cx="220" cy="145" r="4" class="pin-dot"/>
    <text x="165" y="150" class="pin-label">OUT3</text>
    <circle cx="220" cy="165" r="4" class="pin-dot"/>
    <text x="165" y="170" class="pin-label">OUT4</text>
    
    <!-- Power -->
    <circle cx="110" cy="180" r="4" class="pin-dot"/>
    <text x="80" y="195" class="pin-label">VCC (3.3V)</text>
    <circle cx="150" cy="180" r="4" class="pin-dot"/>
    <text x="155" y="195" class="pin-label">GND</text>
  </g>
  
  <!-- Wires: PCM to Optocoupler input -->
  <path d="M 190 535 L 240 535 L 240 525 L 300 525" style="stroke: #f59e0b; stroke-width: 2; fill: none;"/>
  <path d="M 190 555 L 250 555 L 250 545 L 300 545" style="stroke: #f59e0b; stroke-width: 2; fill: none;"/>
  <path d="M 190 575 L 260 575 L 260 565 L 300 565" style="stroke: #f59e0b; stroke-width: 2; fill: none;"/>
  <path d="M 190 595 L 270 595 L 270 585 L 300 585" style="stroke: #f59e0b; stroke-width: 2; fill: none;"/>
  
  <!-- Wires: Optocoupler output to ESP32 -->
  <path d="M 520 525 L 600 525 L 600 300 L 660 300" class="wire-signal"/>
  <path d="M 520 545 L 610 545 L 610 320 L 660 320" class="wire-signal"/>
  <path d="M 520 565 L 620 565 L 620 340 L 660 340" class="wire-signal"/>
  <path d="M 520 585 L 630 585 L 630 360 L 660 360" class="wire-signal"/>
  
  <!-- Ground bus -->
  <g transform="translate(50, 750)">
    <line x1="0" y1="0" x2="1100" y2="0" class="wire-gnd" style="stroke-width: 4;"/>
    <text x="550" y="25" text-anchor="middle" class="pin-label">COMMON GROUND BUS</text>
    
    <!-- Ground connection points -->
    <circle cx="110" cy="0" r="5" class="connection-dot"/>
    <circle cx="320" cy="0" r="5" class="connection-dot"/>
    <circle cx="480" cy="0" r="5" class="connection-dot"/>
    <circle cx="750" cy="0" r="5" class="connection-dot"/>
    <circle cx="450" cy="0" r="5" class="connection-dot"/>
  </g>
  
  <!-- Ground wires to bus -->
  <path d="M 110 230 L 110 750" class="wire-gnd"/>
  <path d="M 320 230 L 320 750" class="wire-gnd"/>
  <path d="M 480 300 L 480 750" class="wire-gnd"/>
  <path d="M 750 310 L 750 750" class="wire-gnd"/>
  <path d="M 450 600 L 450 750" class="wire-gnd"/>
  
  <!-- Notes section -->
  <g transform="translate(50, 650)">
    <text x="0" y="0" class="component-label">IMPORTANT NOTES:</text>
    <text x="0" y="25" class="note">1. Set LM2596 output to 5V BEFORE connecting ESP32</text>
    <text x="0" y="45" class="note">2. PC817 board powered from ESP32 3.3V rail</text>
    <text x="0" y="65" class="note">3. Optocoupler INVERTS signals (code compensates)</text>
    <text x="400" y="25" class="note">4. Add 10µF capacitor near TB6612 VM pin</text>
    <text x="400" y="45" class="note">5. STBY pin must be HIGH for motor to run</text>
    <text x="400" y="65" class="note">6. Use inline fuse (5A) on 12V car power tap</text>
  </g>
  
  <!-- Pin mapping reference -->
  <g transform="translate(800, 450)">
    <rect x="0" y="0" width="300" height="220" class="component-box"/>
    <text x="150" y="25" text-anchor="middle" class="component-label">ESP32 PIN SUMMARY</text>
    
    <text x="20" y="55" class="pin-label">MOTOR CONTROL:</text>
    <text x="30" y="75" class="note">GPIO25 → TB6612 AIN1</text>
    <text x="30" y="95" class="note">GPIO26 → TB6612 AIN2</text>
    <text x="30" y="115" class="note">GPIO27 → TB6612 BIN1</text>
    <text x="30" y="135" class="note">GPIO14 → TB6612 BIN2</text>
    <text x="30" y="155" class="note">GPIO13 → TB6612 STBY</text>
    
    <text x="20" y="185" class="pin-label">PCM MONITORING:</text>
    <text x="30" y="205" class="note">GPIO32 ← PC817 OUT1 (PCM A1)</text>
    <text x="30" y="225" class="note">GPIO33 ← PC817 OUT2 (PCM A2)</text>
    <text x="30" y="245" class="note">GPIO34 ← PC817 OUT3 (PCM B1)</text>
    <text x="30" y="265" class="note">GPIO35 ← PC817 OUT4 (PCM B2)</text>
  </g>
</svg>
